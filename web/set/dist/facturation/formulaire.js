function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(i){var n=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(i);return _possibleConstructorReturn(this,n?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var Formulaire=function(){function a(t,e){_classCallCheck(this,a),this.invoice=t,this.devis=e,this.saver=this.invoice.find(".btnFormSaver"),this.wrapperTheme=this.invoice.find(".articles_wrapper"),this.clientSaver=$("#save_new_client"),this.addBtn=this.invoice.find("#addDetail"),this.data=JSON.parse($("#data_json").val()),this.onLoad=!0,this.newForm="",this.unitMesure="",this.type="",this.aibInput="",this.taxespec="",this.table=$("#liste-article"),this.noProduct=$("#new-facture-no-product"),this.totalArticle=0,this.pu="",this.typeVal="",this.taxeSejour="",this.quantite="",this.produit="",this.uttc="",this.ttc="",this.description="",this.selectCLient=$("#operationsclientbundle_clientfacturevente_client"),e&&(this.selectCLient=$("#operationsclientbundle_clientdevis_client")),this.tvaInput=this.invoice.find(".tva").find("input"),this.clientIsMoral=!1,this.invoice.find(".devise").find("select").val(this.data.devise),e?(this.totalHTInp=$("#operationsclientbundle_clientdevis_totalHT"),this.totalTVAInp=$("#operationsclientbundle_clientdevis_totalTVA"),this.totalAIBInp=$("#operationsclientbundle_clientdevis_totalAIB"),this.totalTTCInp=$("#operationsclientbundle_clientdevis_totalTTC")):(this.totalHTInp=$("#operationsclientbundle_clientfacturevente_totalHT"),this.totalTVAInp=$("#operationsclientbundle_clientfacturevente_totalTVA"),this.totalAIBInp=$("#operationsclientbundle_clientfacturevente_totalAIB"),this.totalTTCInp=$("#operationsclientbundle_clientfacturevente_totalTTC")),this.totalTTSInp=$("#totaltaxespecifique"),this.totalNETInp=$("#totalnet"),this.totalHT=0,this.totalHTTemp=0,this.totalTVA=0,this.totalTVATemp=0,this.totalAIB=0,this.totalAIBTemp=0,this.totalTTC=0,this.totalTTCTemp=0,this.totalTTS=0,this.totalTTSTemp=0,this.totalNET=0,this.totalNETTemp=0,console.log(this.data),this.addArticle(),$("#modal_new_client").on("shown.bs.modal",this.activeClientSaver.bind(this)),this.fillClient(),this.saver.on("click",this.submit.bind(this))}return _createClass(a,null,[{key:"bind",value:function(t,e){var i=1<arguments.length&&void 0!==e&&e,n=$(t);0<n.length&&new a(n,i)}}]),_createClass(a,[{key:"submit",value:function(t){t.preventDefault(),this.newForm.remove(),(this.devis?this.invoice.find('form[name="operationsclientbundle_clientdevis"]'):this.invoice.find('form[name="operationsclientbundle_clientfacturevente"]')).submit()}},{key:"fillClient",value:function(){var i=this;i.selectCLient.html('<option value="" selected="selected">Sélectionnez un client</option>'),$.each(i.data.clients,function(t,e){i.selectCLient.append('<option data-ifu="'+e.ifu+'" data-moral="'+e.moral+'" data-tva="'+e.tva+'" value="'+e.id+'">'+e.nom+"</option>")}),i.selectCLient.chosen({width:"100%",placeholder_text_single:"Sélectionner une option"}),i.selectCLient.trigger("chosen:updated"),i.selectCLient.on("change",function(){console.log("client change");var t=$(this).find('option[value="'+$(this).val()+'"]');i.clientIsMoral=t.data("moral"),i.tvaInput.val(t.data("tva"));t=new CustomEvent("clientChange",{detail:{moral:i.clientIsMoral,ifu:t.data("ifu")}});document.dispatchEvent(t),""!==i.pu&&i.calculator()})}},{key:"selectTypeProduit",value:function(){var e=this;e.resetArticleForm(),e.type.off("change").on("change",function(){e.typeVal="";var t=$(".article_service");"1"===e.type.val()?(e.typeVal="article",t.text("Article")):"2"===e.type.val()&&(e.typeVal="service",t.text("Service")),"article"===e.typeVal&&(e.unitMesure.hide(),e.quantite.removeClass("col-md-6"),e.quantite.addClass("col-md-12")),"service"===e.typeVal&&(e.unitMesure.show(),e.quantite.removeClass("col-md-12"),e.quantite.addClass("col-md-6")),e.produit.html(e.chargeProduit(e.typeVal)),e.typeVal?(e.produit.chosen({width:"100%"}),e.produit.removeAttr("disabled"),e.produit.trigger("chosen:updated"),e.produit.off("change").on("change",e.selecProduit.bind(e))):(e.produit.attr("disabled",1),e.produit.trigger("chosen:updated"),e.selecProduit())})}},{key:"selecProduit",value:function(){var t=this;t.resetArticleForm();var e=t.produit.val();"service"===t.typeVal&&t.unitMesure.find("select").val(t.getInfo("uniteMesure",e)),this.taxeSejour.val(0),"F"===t.getInfo("taxeGroupe",e)?this.taxeSejour.closest(".col-md-12").show("slow"):this.taxeSejour.closest(".col-md-12").hide("slow"),t.pu.val(t.getInfo("prixUnitaireVente",e)),setTimeout(function(){t.quantite.find("input").focus()},200)}},{key:"calculator",value:function(){var t=this.quantite.find("input").val(),e=this.aibInput.val(),i=this.taxeSejour.val(),n=this.taxespec.val(),a=this.pu.val(),o=(this.data.assujetiTva?this.tvaInput.val():0)/100*a,l=this.getInfo("taxeGroupe",this.produit.val()),i=(a=a?+a:0)+(n=n?+n:0)+(e=e?+e:0)+(i=i?+i:0);"A"!==l&&"E"!==l&&(i+=o),this.uttc.val(i),this.ttc.val(i*t),this.totalHTTemp=this.totalHT+a*t,this.totalTTCTemp=this.totalTTC+i*t,this.totalAIBTemp=this.totalAIB+e*t,this.totalTVATemp=this.totalTVA+o*t,this.totalTTSTemp=this.totalTTS+n,this.totalNETTemp=this.netCalculator(this.totalTTCTemp),this.data.liberal&&this.clientIsMoral&&(this.totalNETTemp=this.netCalculator(this.totalTTCTemp-e)),this.totalHTInp.val(Math.round(this.totalHTTemp)),this.totalTVAInp.val(Math.round(this.totalTVATemp)),this.totalTTSInp.val(Math.round(this.totalTTSTemp)),this.totalAIBInp.val(Math.round(this.totalAIBTemp)),this.totalTTCInp.val(Math.round(this.totalTTCTemp)),this.totalNETInp.val(this.totalNETTemp)}},{key:"netCalculator",value:function(t){return this.data.roundPrice&&t%5!=0?t+(5-t%5):t}},{key:"totalCalculator",value:function(){var t=this,e=(this.data.assujetiTva?this.tvaInput.val():0)/100*t.pu.val(),i=this.quantite.find("input").val(),n=this.getInfo("taxeGroupe",this.produit.val());"A"!==n&&"E"!==n||(e=0),this.totalHT+=t.pu.val()*i,this.totalTTC+=+t.ttc.val(),this.totalAIB+=t.aibInput.val()*i,this.totalTVA=+this.totalTVA+e*i,this.totalTTS+=+t.taxespec.val(),this.totalNET=+this.totalNET+ +t.ttc.val(),this.data.liberal&&this.clientIsMoral&&(this.totalNET=+this.totalNET+ +t.ttc.val()-this.totalAIB),this.totalHTInp.val(this.totalHT),this.totalTVAInp.val(this.totalTVA),this.totalTTSInp.val(this.totalTTS),this.totalAIBInp.val(this.totalAIB),this.totalTTCInp.val(this.totalTTC),this.totalNETInp.val(this.totalNET)}},{key:"onInputchange",value:function(){var t=this.quantite.find("input");t.off("change").on("change",this.calculator.bind(this)),t.off("keyup").on("keyup",this.calculator.bind(this)),this.aibInput.closest(".form-group").find('input[type="checkbox"]').off("change").on("change",this.calculator.bind(this)),this.taxespec.off("change").on("change",this.calculator.bind(this)),this.taxespec.off("keyup").on("keyup",this.calculator.bind(this))}},{key:"resetArticleForm",value:function(){this.unitMesure.find("select").val("1"),this.quantite.find("input").val(""),this.aibInput.closest(".form-group").find('input[type="checkbox"]').prop("checked",!1),this.aibInput.val(""),this.taxespec.closest(".form-group").find('input[type="checkbox"]').prop("checked",!1),this.taxespec.val(""),this.ttc.val(""),this.pu.val(""),this.uttc.val(""),this.description.val("")}},{key:"getInfo",value:function(e,i){var n="";return this.data.stock.forEach(function(t){t.id==i&&(n=t[e])}),n}},{key:"chargeProduit",value:function(e){var i='<option value="">Sélectionnez un '+(e=""===e?"élément":e)+"</option>";return this.data.stock.forEach(function(t){t.type===e&&(i+='<option value="'.concat(t.id,'">').concat(t.designation,"</option>"))}),i}},{key:"addArticle",value:function(){var i=this;this.addBtn.off("click").on("click",function(t){var e;t.preventDefault(),i.onLoad||""!==i.selectCLient.val()||i.data.edit?i.onLoad||""!==i.pu.val()&&""!==i.quantite.find("input").val()?($(".article_item").hide(),e=i.wrapperTheme.data("prototype"),t=i.wrapperTheme.data("index"),console.log("index:",t),i.newForm=$(e.replace(/__name__/g,t)),i.wrapperTheme.data("index",t+1),i.wrapperTheme.append(i.newForm),i.onLoad||(i.totalCalculator(),i.addArticleToTable()),i.onLoad=!1,i.unitMesure=i.newForm.find(".unit_mesure"),i.quantite=i.newForm.find(".quantite"),i.type=i.newForm.find(".select_type").find("select"),i.taxeSejour=i.newForm.find(".taxe-de-sejour"),i.produit=i.newForm.find(".select_produit").find("select"),i.produit.attr("disabled","1"),i.pu=i.newForm.find(".prix_vente_unitaire").find("input"),i.aibInput=i.newForm.find(".aib"),i.taxespec=i.newForm.find(".taxespecifique"),i.description=i.newForm.find(".div_description").find("textarea"),i.uttc=i.newForm.find(".prix_unitaire_ttc").find("input"),i.ttc=i.newForm.find(".sousTotalTTC").find("input"),i.onInputchange(),i.selectTypeProduit(),t=i.selectCLient.val()?i.selectCLient.find('option[value="'+i.selectCLient.val()+'"]').data("ifu"):"",console.log("article",t),CheckInput.bind(".checkbox",t,i.data.liberal),$(".select_article:last").chosen({width:"100%",placeholder_text_single:"Sélectionnez une option"}),$(".select_type_produit").chosen({width:"100%",placeholder_text_single:"Sélectionnez un type"})):i.notif("Veuillez remplir tous les champs et reéssayer","warning"):i.notif("Veuillez renseigner un client au premier abord","warning")}),this.addBtn.click()}},{key:"addArticleToTable",value:function(){var t=this;t.totalArticle++;var e=$('\n      <tr style="display: none;">\n        <td>'.concat(t.produit.find("option:selected").text(),"</td>\n        <td>").concat(t.quantite.find("input").val(),"</td>\n        <td>").concat(t.aibInput.val(),"</td>\n        <td>").concat(Math.round(""!=t.taxespec.val()?t.taxespec.val():0),"</td>\n        <td>").concat(Math.round(t.ttc.val()),"</td>\n        <td>").concat(t.description.val().substring(0,15)+"...",'</td>\n        <td>\n          <div class="btn-group">\n            <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">\n              Action\n            </button>\n            <ul class="dropdown-menu">\n              <li><a href="#"><i class="fa fa-edit"></i> Editer</a></li>\n              <li><a href="#"><i class="fa fa-trash"></i> Supprimer</a></li>\n            </ul>\n          </div>\n        </td>\n      </tr>\n    '));t.table.append(e),e.show("slow"),1===t.totalArticle&&t.noProduct.hide("slow")}},{key:"notif",value:function(t,e){e=e||"success";var i=$("#alert-raw");i.fadeOut(1),i.removeClass("alert-danger"),i.removeClass("alert-success"),i.removeClass("alert-warning"),i.addClass("alert-"+e),i.find("p").text(t),i.fadeIn(500),i.find(".user-close-message-box").on("click",function(){i.fadeOut(2e3)}),setTimeout(function(){i.fadeOut(2e3)},1e4)}},{key:"activeClientSaver",value:function(){this.clientSaver.off("click").on("click",this.saveClient.bind(this))}},{key:"saveClient",value:function(t){t.preventDefault();var i=this,e=i.clientSaver;e.button("loading");var n=!1;if($(".req").each(function(){""===$(this).val()&&($("#ctl_al").show(),n=!0)}),n)return 0;t=$("#formNewClient");$.ajax({type:"POST",url:t.attr("action"),processData:!1,contentType:!1,data:new FormData(t[0]),success:function(t){void 0!==t.error?($("#modal_new_client").find(".modal-content").html(t.body),$("#save_new_client").off("click").on("click",i.saveClient.bind(i))):($.each(t.arrayClients,function(t,e){i.selectCLient.append('<option data-ifu="'+e.ifu+'" data-moral="'+e.moral+'" data-tva="'+e.tva+'" selected value="'+e.id+'">'+e.nom+"</option>")}),i.selectCLient.chosen({width:"100%",placeholder_text_single:"Sélectionner une option"}),i.selectCLient.val(t.idNewClient),i.selectCLient.trigger("chosen:updated"),$("#form_shortcut_new_client").empty(),$("#newClient").hide(),$("#modal_new_client").modal("hide"))},always:function(){e.button("reset")}})}}]),a}(),FormulaireEdit=function(){_inherits(a,Formulaire);var i=_createSuper(a);function a(t,e){return _classCallCheck(this,a),(t=i.call(this,t,e)).entity="clientfacturevente",e&&(t.entity="clientdevis"),t.oldArticle=$("#operationsclientbundle_"+t.entity+"_details"),t.edit=t.data.edit,t.dateFacture=$(".date-facture").find("input"),t.dateReglement=$(".date-reglement").find("input"),t.edit&&(t.fillFacture(),console.log("edit"),t.preFillArticleToTable()),t}return _createClass(a,null,[{key:"bind",value:function(t,e){var i=1<arguments.length&&void 0!==e&&e,n=$(t);0<n.length&&new a(n,i)}}]),_createClass(a,[{key:"fillFacture",value:function(){var t=this.selectCLient.closest(".input-group"),e=t.parent();t.hide(),e.append('<div class="input-group"><input type="text" class="form-control" readonly="readonly" value="'.concat(this.edit.client,'"></div>'));t=this.edit.data_facture.date,e=(new Date).getFullYear()+"-"+(new Date).getMonth()+"-"+(new Date).getDay()+" 00:00:00";this.edit.data_reglement&&(e=this.edit.data_reglement.date),t=t.split(" "),e=e.split(" "),this.dateFacture.val(t[0]),this.dateReglement.val(e[0]),console.log(t[0],e[0]),this.invoice.find(".devise").find("select").val(this.edit.devise),this.tvaInput.val(this.edit.tva),this.totalNETInp.val(this.netCalculator(this.totalTTCInp.val()))}},{key:"preFillArticleToTable",value:function(){var i=this;this.oldArticle.children().each(function(){var t=$(this),e=i.totalArticle,e="#operationsclientbundle_"+i.entity+"_details_"+e+"_";i.totalArticle++;e=$('\n        <tr style="display: none;">\n          <td>'.concat(t.find(e+"produit").find("option:selected").text(),"</td>\n          <td>").concat(t.find(e+"quantite").val(),"</td>\n          <td>").concat(t.find(e+"tauxAIB").val(),"</td>\n          <td>").concat(Math.round(""!=t.find(e+"taxeSpecifique").val()?t.find(e+"taxeSpecifique").val():0),"</td>\n          <td>").concat(Math.round(t.find(e+"prixVenteUnitaire").val()*t.find(e+"quantite").val()),"</td>\n          <td>").concat(t.find(e+"description").text().substring(0,15)+"...",'</td>\n          <td>\n            <div class="btn-group">\n              <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">\n                Action\n              </button>\n              <ul class="dropdown-menu">\n                <li><a href="#"><i class="fa fa-edit"></i> Editer</a></li>\n                <li><a href="#"><i class="fa fa-trash"></i> Supprimer</a></li>\n              </ul>\n            </div>\n          </td>\n        </tr>\n      '));i.table.append(e),e.show("slow"),1===i.totalArticle&&i.noProduct.hide("slow")})}}]),a}();